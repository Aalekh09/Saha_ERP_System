<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Status Test - Saha Institute</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="header-info">
                <h1>API Status Test</h1>
                <p>Test API connectivity and fallback system</p>
            </div>
        </div>
    </header>

    <div class="main-container">
        <div class="content-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <h2><i class="fas fa-server"></i> API Status Dashboard</h2>
                    <p class="subtitle">Monitor API connectivity and test fallback systems</p>
                </div>
                <div class="panel-actions">
                    <button class="btn-primary" onclick="testAllAPIs()">
                        <i class="fas fa-sync-alt"></i> Test All APIs
                    </button>
                </div>
            </div>
            <div class="panel-content">
                <div class="api-test-grid">
                    <div class="api-test-card">
                        <div class="api-test-header">
                            <h3>Students API</h3>
                            <div class="api-status checking" id="studentsStatus">
                                <i class="fas fa-circle"></i>
                                <span>Testing...</span>
                            </div>
                        </div>
                        <div class="api-test-body">
                            <p>Endpoint: <code>/api/students</code></p>
                            <div class="test-results" id="studentsResults">
                                <div class="loading-skeleton text"></div>
                            </div>
                        </div>
                        <div class="api-test-actions">
                            <button class="btn-outline" onclick="testStudentsAPI()">
                                <i class="fas fa-play"></i> Test
                            </button>
                        </div>
                    </div>

                    <div class="api-test-card">
                        <div class="api-test-header">
                            <h3>Attendance API</h3>
                            <div class="api-status checking" id="attendanceStatus">
                                <i class="fas fa-circle"></i>
                                <span>Testing...</span>
                            </div>
                        </div>
                        <div class="api-test-body">
                            <p>Endpoint: <code>/api/attendance/{date}</code></p>
                            <div class="test-results" id="attendanceResults">
                                <div class="loading-skeleton text"></div>
                            </div>
                        </div>
                        <div class="api-test-actions">
                            <button class="btn-outline" onclick="testAttendanceAPI()">
                                <i class="fas fa-play"></i> Test
                            </button>
                        </div>
                    </div>

                    <div class="api-test-card">
                        <div class="api-test-header">
                            <h3>Payments API</h3>
                            <div class="api-status checking" id="paymentsStatus">
                                <i class="fas fa-circle"></i>
                                <span>Testing...</span>
                            </div>
                        </div>
                        <div class="api-test-body">
                            <p>Endpoint: <code>/api/payments</code></p>
                            <div class="test-results" id="paymentsResults">
                                <div class="loading-skeleton text"></div>
                            </div>
                        </div>
                        <div class="api-test-actions">
                            <button class="btn-outline" onclick="testPaymentsAPI()">
                                <i class="fas fa-play"></i> Test
                            </button>
                        </div>
                    </div>

                    <div class="api-test-card">
                        <div class="api-test-header">
                            <h3>Mock API System</h3>
                            <div class="api-status online" id="mockStatus">
                                <i class="fas fa-circle"></i>
                                <span>Always Available</span>
                            </div>
                        </div>
                        <div class="api-test-body">
                            <p>Fallback system with demo data</p>
                            <div class="test-results" id="mockResults">
                                <div class="result-item success">
                                    <i class="fas fa-check"></i>
                                    <span>Mock API is ready</span>
                                </div>
                                <div class="result-item info">
                                    <i class="fas fa-info"></i>
                                    <span>6 demo students available</span>
                                </div>
                                <div class="result-item info">
                                    <i class="fas fa-info"></i>
                                    <span>30 days of attendance data</span>
                                </div>
                            </div>
                        </div>
                        <div class="api-test-actions">
                            <button class="btn-outline" onclick="testMockAPI()">
                                <i class="fas fa-play"></i> Test Mock
                            </button>
                        </div>
                    </div>
                </div>

                <div class="system-info">
                    <h3><i class="fas fa-info-circle"></i> System Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="label">Backend URL:</span>
                            <span class="value">https://aalekhapi.sahaedu.in</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Fallback System:</span>
                            <span class="value">Mock API with Demo Data</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Auto-Detection:</span>
                            <span class="value">Enabled (30s cache)</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Timeout:</span>
                            <span class="value">2 seconds</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/mockAPI.js"></script>
    <script>
        async function testStudentsAPI() {
            const statusEl = document.getElementById('studentsStatus');
            const resultsEl = document.getElementById('studentsResults');
            
            statusEl.className = 'api-status checking';
            statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Testing...</span>';
            resultsEl.innerHTML = '<div class="loading-skeleton text"></div>';
            
            try {
                const students = await window.apiWrapper.get('/api/students');
                
                statusEl.className = 'api-status online';
                statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Online</span>';
                resultsEl.innerHTML = `
                    <div class="result-item success">
                        <i class="fas fa-check"></i>
                        <span>Loaded ${students.length} students</span>
                    </div>
                    <div class="result-item info">
                        <i class="fas fa-info"></i>
                        <span>Response time: < 1s</span>
                    </div>
                `;
            } catch (error) {
                statusEl.className = 'api-status offline';
                statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Offline</span>';
                resultsEl.innerHTML = `
                    <div class="result-item error">
                        <i class="fas fa-times"></i>
                        <span>API unavailable</span>
                    </div>
                    <div class="result-item warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Using mock data</span>
                    </div>
                `;
            }
        }

        async function testAttendanceAPI() {
            const statusEl = document.getElementById('attendanceStatus');
            const resultsEl = document.getElementById('attendanceResults');
            const today = new Date().toISOString().split('T')[0];
            
            statusEl.className = 'api-status checking';
            statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Testing...</span>';
            resultsEl.innerHTML = '<div class="loading-skeleton text"></div>';
            
            try {
                const attendance = await window.apiWrapper.get(`/api/attendance/${today}`);
                
                statusEl.className = 'api-status online';
                statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Online</span>';
                resultsEl.innerHTML = `
                    <div class="result-item success">
                        <i class="fas fa-check"></i>
                        <span>Attendance data loaded</span>
                    </div>
                    <div class="result-item info">
                        <i class="fas fa-info"></i>
                        <span>Date: ${attendance.date}</span>
                    </div>
                `;
            } catch (error) {
                statusEl.className = 'api-status offline';
                statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Offline</span>';
                resultsEl.innerHTML = `
                    <div class="result-item error">
                        <i class="fas fa-times"></i>
                        <span>API unavailable</span>
                    </div>
                    <div class="result-item warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Using mock data</span>
                    </div>
                `;
            }
        }

        async function testPaymentsAPI() {
            const statusEl = document.getElementById('paymentsStatus');
            const resultsEl = document.getElementById('paymentsResults');
            
            statusEl.className = 'api-status checking';
            statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Testing...</span>';
            resultsEl.innerHTML = '<div class="loading-skeleton text"></div>';
            
            try {
                const payments = await window.apiWrapper.get('/api/payments');
                
                statusEl.className = 'api-status online';
                statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Online</span>';
                resultsEl.innerHTML = `
                    <div class="result-item success">
                        <i class="fas fa-check"></i>
                        <span>Loaded ${payments.length} payments</span>
                    </div>
                    <div class="result-item info">
                        <i class="fas fa-info"></i>
                        <span>Response time: < 1s</span>
                    </div>
                `;
            } catch (error) {
                statusEl.className = 'api-status offline';
                statusEl.innerHTML = '<i class="fas fa-circle"></i><span>Offline</span>';
                resultsEl.innerHTML = `
                    <div class="result-item error">
                        <i class="fas fa-times"></i>
                        <span>API unavailable</span>
                    </div>
                    <div class="result-item warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Using mock data</span>
                    </div>
                `;
            }
        }

        async function testMockAPI() {
            const resultsEl = document.getElementById('mockResults');
            
            try {
                const students = await window.mockAPI.getStudents();
                const payments = await window.mockAPI.getPayments();
                const attendance = await window.mockAPI.getAttendance(new Date().toISOString().split('T')[0]);
                
                resultsEl.innerHTML = `
                    <div class="result-item success">
                        <i class="fas fa-check"></i>
                        <span>Mock API working perfectly</span>
                    </div>
                    <div class="result-item info">
                        <i class="fas fa-info"></i>
                        <span>${students.length} demo students</span>
                    </div>
                    <div class="result-item info">
                        <i class="fas fa-info"></i>
                        <span>${payments.length} demo payments</span>
                    </div>
                    <div class="result-item info">
                        <i class="fas fa-info"></i>
                        <span>Attendance data: ${Object.keys(attendance.attendance).length} records</span>
                    </div>
                `;
            } catch (error) {
                resultsEl.innerHTML = `
                    <div class="result-item error">
                        <i class="fas fa-times"></i>
                        <span>Mock API error: ${error.message}</span>
                    </div>
                `;
            }
        }

        async function testAllAPIs() {
            await Promise.all([
                testStudentsAPI(),
                testAttendanceAPI(),
                testPaymentsAPI(),
                testMockAPI()
            ]);
        }

        // Auto-test on page load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(testAllAPIs, 1000);
        });
    </script>

    <style>
        .api-test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .api-test-card {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            transition: all 0.3s ease;
        }

        .api-test-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .api-test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .api-test-header h3 {
            margin: 0;
            color: var(--text-primary);
        }

        .api-test-body {
            margin-bottom: var(--spacing-md);
        }

        .api-test-body p {
            margin: 0 0 var(--spacing-sm) 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .api-test-body code {
            background: var(--background-color);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.8rem;
        }

        .test-results {
            min-height: 60px;
        }

        .result-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-xs) 0;
            font-size: 0.875rem;
        }

        .result-item.success {
            color: var(--success-color);
        }

        .result-item.error {
            color: var(--error-color);
        }

        .result-item.warning {
            color: var(--warning-color);
        }

        .result-item.info {
            color: var(--text-secondary);
        }

        .api-test-actions {
            border-top: 1px solid var(--border-color);
            padding-top: var(--spacing-md);
        }

        .system-info {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
        }

        .system-info h3 {
            margin: 0 0 var(--spacing-md) 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .info-grid {
            display: grid;
            gap: var(--spacing-sm);
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border-color);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-item .label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .info-item .value {
            color: var(--text-secondary);
            font-family: monospace;
            font-size: 0.875rem;
        }

        /* API Status styles (reused from attendance.css) */
        .api-status {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid var(--border-color);
            background: var(--surface-color);
        }

        .api-status.online {
            color: #10b981;
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .api-status.offline {
            color: #f59e0b;
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .api-status.checking {
            color: var(--text-secondary);
            border-color: var(--border-color);
        }

        .api-status i {
            font-size: 0.5rem;
        }

        .api-status.checking i {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</body>
</html>